"use strict";(self["webpackChunkmoney_catcher"]=self["webpackChunkmoney_catcher"]||[]).push([[54],{5632:function(e,l,t){t.d(l,{Z:function(){return g}});var a=t(3396),n=t(4870),r=t(7139),i=t(9242),s=t(9545),o=t(1020);const c={class:"input-field"},d={key:0,selected:"",value:"12"},u=["value"],v=(0,a._)("label",null,"Фильтрация по месяцам",-1);var m=(0,a.aZ)({__name:"MonthSelectComponent",props:{showAll:{type:Boolean}},setup(e){const{transactionsMonthFilter:l}=(0,o.Jk)((0,s.C)()),t=(0,n.iH)(),m=(0,n.iH)(),_=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];return(0,a.bv)((()=>{m.value=M.FormSelect.init(t.value)})),(e,s)=>((0,a.wg)(),(0,a.iD)("div",c,[(0,a.wy)((0,a._)("select",{ref_key:"monthSelect",ref:t,"onUpdate:modelValue":s[0]||(s[0]=e=>(0,n.dq)(l)?l.value=e:null)},[e.$props.showAll?((0,a.wg)(),(0,a.iD)("option",d,"Показать всё")):(0,a.kq)("",!0),((0,a.wg)(),(0,a.iD)(a.HY,null,(0,a.Ko)(_,((e,l)=>(0,a._)("option",{key:l,value:l},(0,r.zw)(e),9,u))),64))],512),[[i.bM,(0,n.SU)(l),void 0,{number:!0}]]),v]))}});const _=m;var g=_},6838:function(e,l,t){t.d(l,{Z:function(){return g}});t(560);var a=t(3396),n=t(4870),r=t(7139),i=t(9242),s=t(9545),o=t(1020),c=t(3060);const d={class:"input-field"},u=["value"],v=(0,a._)("label",null,"Фильтрация по годам",-1);var m=(0,a.aZ)({__name:"YearSelectComponent",setup(e){const{transactions:l,transactionsYearFilter:t}=(0,o.Jk)((0,s.C)()),{isGlobalLoading:m}=(0,o.Jk)((0,c.e)());m.value=!0;const _=(0,n.iH)(),g=(0,n.iH)(),w=(0,a.Fl)((()=>{const e=[],t=new Set;t.add((new Date).getFullYear()),l.value.forEach((e=>{const l=new Date(e.date).getFullYear();t.add(l)}));const a=Math.max.apply(null,Array.from(t))+1;t.add(a);const n=Array.from(t).sort(((e,l)=>e-l));return n.forEach((l=>{const t={year:l,id:Math.floor(1e6*Math.random())};e.push(t)})),m.value=!1,e}));return(0,a.bv)((()=>{g.value=M.FormSelect.init(_.value)})),(0,a.ic)((()=>{g.value=M.FormSelect.init(_.value)})),(e,l)=>((0,a.wg)(),(0,a.iD)("div",d,[(0,a.wy)((0,a._)("select",{ref_key:"yearSelect",ref:_,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,n.dq)(t)?t.value=e:null)},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(w.value,(e=>((0,a.wg)(),(0,a.iD)("option",{key:e.id,value:e.year},(0,r.zw)(e.year),9,u)))),128))],512),[[i.bM,(0,n.SU)(t),void 0,{number:!0}]]),v]))}});const _=m;var g=_},2054:function(e,l,t){t.r(l),t.d(l,{default:function(){return R}});var a=t(3396),n=t(4870),r=t(7139),i=t(5632),s=t(6838),o=t(1020),c=t(1520),d=t(9545),u=t(6135),v=t(3256);const m=e=>((0,a.dD)("data-v-0b078616"),e=e(),(0,a.Cn)(),e),_=m((()=>(0,a._)("h3",null,"Планирование",-1))),g=m((()=>(0,a._)("hr",null,null,-1))),w={key:0,class:"row"},p={class:"col"},h=m((()=>(0,a._)("p",null,"У Вас нет ни одной расходной категории.",-1))),k={key:1,class:"row"},y={key:0,class:"red-text"},b={key:2},f={class:"row valign-wrapper"},F={class:"col s12 m4"},D=["disabled"],S=m((()=>(0,a._)("i",{class:"material-icons right"},"calculate",-1))),U={class:"col s12 m2 offset-m3"},C={class:"col s12 m3"},x={class:"row scrollable"},z={key:0},M={key:0,class:"red-text"},T={class:"progress"},H={class:"highlight centered responsive-table"},Y=m((()=>(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"Дата"),(0,a._)("th",null,"Счёт"),(0,a._)("th",null,"Сумма"),(0,a._)("th",{class:"fixed-width"},"Комментарий"),(0,a._)("th",{class:"fixed-width"},"Действия")])],-1))),N={class:"row mb-0 flex-center"},Z={class:"col"},q=["id"],J=m((()=>(0,a._)("i",{class:"material-icons"},"done_all",-1))),A=[J],E={class:"col"},I=["id","data-target"],K=m((()=>(0,a._)("i",{class:"material-icons"},"edit",-1))),L=[K],P={class:"col"},V=["id"],W=m((()=>(0,a._)("i",{class:"material-icons"},"delete",-1))),B=[W];var j=(0,a.aZ)({__name:"PlanningView",setup(e){const{categoriesAvailableForLimitation:l}=(0,o.Jk)((0,c.x)()),{selectedTransactionId:t,outcomeTransactions:m,transactionsMonthFilter:J}=(0,o.Jk)((0,d.C)()),{changeTransactionToRegular:K}=(0,d.C)(),{limits:W}=(0,o.Jk)((0,u.L)()),{currencyFilter:j,dateFilter:G}=(0,v.y)(),O=(0,a.Fl)((()=>l.value.map((e=>{const l=m.value.filter((l=>l.categoryId===e.id)).filter((e=>e.isForecast))||[],t=m.value.filter((l=>l.categoryId===e.id)).filter((e=>!e.isForecast)).reduce(((e,l)=>Number((e+=+l.amount).toFixed(2))),0),a=W.value.find((l=>l.categoryId===e.id));let n;n=a?a.limit:0;const r=t-n>0?Number((t-n).toFixed(2)):0,i=n>0?100*t/n:n,s=i>100?100:i,o=i<80?"green":i<100?"yellow":"red";return{...e,records:l,spend:t,limit:n,overspend:r,progressPercent:s,progressColor:o}})).sort(((e,l)=>e.name>l.name?1:e.name<l.name?-1:0)))),R=(0,a.Fl)((()=>{if(12===J.value){let e=O.value.reduce(((e,l)=>Number((e+l.limit).toFixed(2))),0);return e*=J.value,e}return O.value.reduce(((e,l)=>Number((e+l.limit).toFixed(2))),0)})),$=(0,a.Fl)((()=>O.value.reduce(((e,l)=>Number((e+l.spend).toFixed(2))),0))),Q=(0,a.Fl)((()=>O.value.reduce(((e,l)=>Number((e+l.overspend).toFixed(2))),0))),X=e=>{let l;l="BUTTON"===e.target.tagName?e.target:e.target.parentElement,t.value=l.id};let ee=0;const le=async e=>{const l=e;try{if(ee++,X(l),!t.value)return;await K()}catch(a){console.log(a),ee<5&&setTimeout((()=>le(l)),100)}};return(e,t)=>{const o=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)(a.HY,null,[_,g,0===(0,n.SU)(l).length?((0,a.wg)(),(0,a.iD)("div",w,[(0,a._)("div",p,[h,(0,a._)("p",null,[(0,a.Uk)("Добавьте хотя бы одну расходную "),(0,a.Wm)(o,{to:"/categories"},{default:(0,a.w5)((()=>[(0,a.Uk)("категорию")])),_:1})])])])):((0,a.wg)(),(0,a.iD)("div",k,[(0,a._)("h5",null,[(0,a.Uk)(" Запланировано: "+(0,r.zw)((0,n.SU)(j)(R.value))+". Израсходовано: "+(0,r.zw)((0,n.SU)(j)($.value))+". ",1),Q.value>0?((0,a.wg)(),(0,a.iD)("small",y," Перерасход: "+(0,r.zw)((0,n.SU)(j)(Q.value)),1)):(0,a.kq)("",!0)])])),O.value.length>0?((0,a.wg)(),(0,a.iD)("section",b,[(0,a._)("div",f,[(0,a._)("div",F,[(0,a._)("button",{disabled:0===(0,n.SU)(l).length,class:"btn modal-trigger","data-target":"modalSetLimit"},[S,(0,a.Uk)(" Установить лимит ")],8,D)]),(0,a._)("div",U,[(0,a.Wm)(s.Z)]),(0,a._)("div",C,[(0,a.Wm)(i.Z,{"show-all":!0})])]),(0,a._)("div",x,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(O.value,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"row"},[e&&(e.limit>0||e.records.length>0||e.spend>0)?((0,a.wg)(),(0,a.iD)("div",z,[(0,a._)("p",null,[(0,a._)("strong",null,(0,r.zw)(e.name),1),(0,a.Uk)(" "+(0,r.zw)((0,n.SU)(j)(e["spend"]))+" из "+(0,r.zw)((0,n.SU)(j)(e["limit"]))+" ",1),e.overspend>0?((0,a.wg)(),(0,a.iD)("small",M,"Перерасход на "+(0,r.zw)((0,n.SU)(j)(e.overspend)),1)):(0,a.kq)("",!0)]),(0,a._)("div",T,[(0,a._)("div",{class:(0,r.C_)([[e.progressColor],"determinate"]),style:(0,r.j5)({width:e.progressPercent+"%"})},null,6)]),(0,a._)("table",H,[Y,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.records,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",null,(0,r.zw)((0,n.SU)(G)(e["date"])),1),(0,a._)("td",null,(0,r.zw)(e["account"]),1),(0,a._)("td",null,(0,r.zw)((0,n.SU)(j)(e["amount"])),1),(0,a._)("td",null,(0,r.zw)(e["description"]),1),(0,a._)("td",null,[(0,a._)("div",N,[(0,a._)("div",Z,[(0,a._)("button",{id:e.id,class:"green btn",onClick:le},A,8,q)]),(0,a._)("div",E,[(0,a._)("button",{id:e.id,"data-target":"transfer"===e.type?"modalEditTransfer":"modalEditTransaction",class:"yellow btn modal-trigger black-text",onClick:X},L,8,I)]),(0,a._)("div",P,[(0,a._)("button",{id:e.id,class:"red btn modal-trigger","data-target":"modalDeleteTransaction",onClick:X},B,8,V)])])])])))),128))])])])):(0,a.kq)("",!0)])))),128))])])):(0,a.kq)("",!0)],64)}}}),G=t(89);const O=(0,G.Z)(j,[["__scopeId","data-v-0b078616"]]);var R=O}}]);