{"version":3,"file":"js/480.b0150239.js","mappings":"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","sources":["webpack://vue-cash/./src/views/Record.vue","webpack://vue-cash/./src/views/Record.vue?707c"],"sourcesContent":["<template>\n  <div>\n    <div class=\"page-title\">\n      <h3>Новая запись</h3>\n    </div>\n\n    <Loader v-if=\"loading\" />\n\n    <p v-else-if=\"!categories.length\" class=\"center\">\n      <router-link to=\"/categories\">\n        Добавьте хотя бы одну категорию\n      </router-link>\n    </p>\n\n    <form v-else class=\"form\" @submit.prevent=\"handleSubmit\">\n      <div class=\"input-field\">\n        <select ref=\"select\" v-model=\"category\">\n          <option v-for=\"c in categories\" :key=\"c.id\" :value=\"c.id\">\n            {{ c.title }}\n          </option>\n        </select>\n        <label>Выберите категорию</label>\n      </div>\n\n      <p>\n        <label>\n          <input\n            class=\"with-gap\"\n            name=\"type\"\n            type=\"radio\"\n            value=\"income\"\n            v-model=\"type\"\n          />\n          <span>Доход</span>\n        </label>\n      </p>\n\n      <p>\n        <label>\n          <input\n            class=\"with-gap\"\n            name=\"type\"\n            type=\"radio\"\n            value=\"outcome\"\n            v-model=\"type\"\n          />\n          <span>Расход</span>\n        </label>\n      </p>\n\n      <div class=\"input-field\">\n        <input\n          id=\"amount\"\n          type=\"number\"\n          v-model.number=\"amount\"\n          :class=\"{ invalid: v$.amount.$dirty && amountMinInvalid }\"\n        />\n        <label for=\"amount\">Сумма</label>\n        <span\n          class=\"helper-text invalid\"\n          v-if=\"v$.amount.$dirty && amountMinInvalid\"\n        >\n          Минимальная величина {{ amountMinValue }}\n        </span>\n      </div>\n\n      <div class=\"input-field\">\n        <input\n          id=\"description\"\n          type=\"text\"\n          v-model=\"description\"\n          :class=\"{ invalid: v$.description.$dirty && descriptionRequired }\"\n        />\n        <label for=\"description\">Описание</label>\n        <span\n          class=\"helper-text invalid\"\n          v-if=\"v$.description.$dirty && descriptionRequired\"\n        >\n          Укажите описание\n        </span>\n      </div>\n\n      <button class=\"btn waves-effect waves-light\" type=\"submit\">\n        Создать\n        <i class=\"material-icons right\">send</i>\n      </button>\n    </form>\n  </div>\n</template>\n\n<script>\nimport Loader from \"@/components/app/Loader.vue\";\nimport { useVuelidate } from \"@vuelidate/core\";\nimport { minValue, required } from \"@vuelidate/validators\";\nimport { mapGetters } from \"vuex\";\n\nexport default {\n  setup() {\n    return { v$: useVuelidate() };\n  },\n  name: \"Record\",\n  components: { Loader },\n  data() {\n    return {\n      loading: true,\n      categories: [],\n      select: null,\n      category: null,\n      type: \"outcome\",\n      amount: 1,\n      description: \"\",\n    };\n  },\n  validations() {\n    return {\n      amount: { minValue: minValue(0.01) },\n      description: { required },\n    };\n  },\n  computed: {\n    ...mapGetters([\"info\"]),\n    amountMinInvalid() {\n      // noinspection JSUnresolvedReference\n      return this.v$.amount.minValue.$invalid;\n    },\n    amountMinValue() {\n      return this.v$.amount.minValue.$params.min;\n    },\n    descriptionRequired() {\n      return this.v$.description.required.$invalid;\n    },\n    canCreateRecord() {\n      if (this.type === \"income\") {\n        return true;\n      }\n\n      return this.info.bill >= this.amount;\n    },\n  },\n  methods: {\n    async handleSubmit() {\n      if (this.v$.$invalid) {\n        this.v$.$touch();\n        return;\n      }\n\n      if (this.canCreateRecord) {\n        try {\n          await this.$store.dispatch(\"createRecord\", {\n            categoryId: this.category,\n            amount: this.amount,\n            description: this.description,\n            type: this.type,\n            date: new Date().toJSON(),\n          });\n          const bill =\n            this.type === \"income\"\n              ? this.info.bill + this.amount\n              : this.info.bill - this.amount;\n          await this.$store.dispatch(\"updateInfo\", { bill });\n          this.$message(\"Запись успешно создана\");\n          this.v$.$reset();\n          this.amount = 1;\n          this.description = \"\";\n        } catch (e) {}\n      } else {\n        this.$message(\n          `Недостаточно средств на счете (${this.amount - this.info.bill})`\n        );\n      }\n    },\n  },\n  async mounted() {\n    this.categories = await this.$store.dispatch(\"fetchCategories\");\n    this.loading = false;\n\n    if (this.categories) {\n      this.category = this.categories[0].id;\n    }\n\n    setTimeout(() => {\n      // noinspection JSCheckFunctionSignatures\n      this.select = M.FormSelect.init(this.$refs.select);\n      M.updateTextFields();\n    }, 0);\n  },\n  beforeUnmount() {\n    if (this.select && this.select.destroy) {\n      this.select.destroy();\n    }\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n","import { render } from \"./Record.vue?vue&type=template&id=5a2fab9e\"\nimport script from \"./Record.vue?vue&type=script&lang=js\"\nexport * from \"./Record.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","class","for","type","_createElementBlock","_hoisted_1","$data","loading","_createBlock","_component_Loader","key","categories","length","onSubmit","_cache","_withModifiers","args","$options","handleSubmit","_hoisted_3","ref","category","$event","_Fragment","_renderList","c","id","value","title","_hoisted_4","_hoisted_5","name","_hoisted_6","_hoisted_7","_hoisted_8","amount","_normalizeClass","invalid","$setup","v$","$dirty","amountMinInvalid","_hoisted_9","_hoisted_10","_toDisplayString","amountMinValue","_hoisted_11","description","descriptionRequired","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_2","_createVNode","_component_router_link","to","setup","useVuelidate","components","Loader","data","select","validations","minValue","required","computed","mapGetters","this","$invalid","$params","min","canCreateRecord","info","bill","methods","$touch","$store","dispatch","categoryId","date","Date","toJSON","$message","$reset","e","mounted","setTimeout","M","FormSelect","init","$refs","updateTextFields","beforeUnmount","destroy","__exports__","render"],"sourceRoot":""}