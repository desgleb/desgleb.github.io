"use strict";(self["webpackChunkmoney_catcher"]=self["webpackChunkmoney_catcher"]||[]).push([[889],{5632:function(e,l,t){t.d(l,{Z:function(){return g}});var a=t(3396),n=t(4870),r=t(7139),i=t(9242),s=t(9545),o=t(1020);const d={class:"input-field"},c={key:0,selected:"",value:"12"},u=["value"],v=(0,a._)("label",null,"Фильтрация по месяцам",-1);var m=(0,a.aZ)({__name:"MonthSelectComponent",props:{showAll:{type:Boolean}},setup(e){const{transactionsMonthFilter:l}=(0,o.Jk)((0,s.C)()),t=(0,n.iH)(),m=(0,n.iH)(),_=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"];return(0,a.bv)((()=>{m.value=M.FormSelect.init(t.value)})),(e,s)=>((0,a.wg)(),(0,a.iD)("div",d,[(0,a.wy)((0,a._)("select",{ref_key:"monthSelect",ref:t,"onUpdate:modelValue":s[0]||(s[0]=e=>(0,n.dq)(l)?l.value=e:null)},[e.$props.showAll?((0,a.wg)(),(0,a.iD)("option",c,"Показать всё")):(0,a.kq)("",!0),((0,a.wg)(),(0,a.iD)(a.HY,null,(0,a.Ko)(_,((e,l)=>(0,a._)("option",{key:l,value:l},(0,r.zw)(e),9,u))),64))],512),[[i.bM,(0,n.SU)(l),void 0,{number:!0}]]),v]))}});const _=m;var g=_},6838:function(e,l,t){t.d(l,{Z:function(){return _}});var a=t(3396),n=t(4870),r=t(7139),i=t(9242),s=t(9545),o=t(1020);const d={class:"input-field"},c=["value"],u=(0,a._)("label",null,"Фильтрация по годам",-1);var v=(0,a.aZ)({__name:"YearSelectComponent",setup(e){const{transactionsSortedByDate:l,transactionsYearFilter:t}=(0,o.Jk)((0,s.C)()),v=(0,n.iH)(),m=(0,n.iH)(),_=(0,a.Fl)((()=>{const e=new Set;if(e.add((new Date).getFullYear()),l.value){l.value.forEach((l=>{const t=new Date(l.date).getFullYear();e.add(t)}));const t=Array.from(e),a=Math.max.apply(null,t)+1;return e.add(a),e}return e}));return(0,a.bv)((()=>{m.value=M.FormSelect.init(v.value)})),(e,l)=>((0,a.wg)(),(0,a.iD)("div",d,[(0,a.wy)((0,a._)("select",{ref_key:"yearSelect",ref:v,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,n.dq)(t)?t.value=e:null)},[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(_.value,(e=>((0,a.wg)(),(0,a.iD)("option",{key:e,value:e},(0,r.zw)(e),9,c)))),128))],512),[[i.bM,(0,n.SU)(t),void 0,{number:!0}]]),u]))}});const m=v;var _=m},5889:function(e,l,t){t.r(l),t.d(l,{default:function(){return R}});var a=t(3396),n=t(4870),r=t(7139),i=t(5632),s=t(6838),o=t(1020),d=t(1520),c=t(9545),u=t(6135),v=t(3256);const m=e=>((0,a.dD)("data-v-4d7a384f"),e=e(),(0,a.Cn)(),e),_=m((()=>(0,a._)("h3",null,"Планирование",-1))),g=m((()=>(0,a._)("hr",null,null,-1))),w={key:0,class:"row"},p={class:"col"},k=m((()=>(0,a._)("p",null,"У Вас нет ни одной расходной категории.",-1))),h={key:1,class:"row"},f={key:0,class:"red-text"},y={key:2},b={class:"row valign-wrapper"},F={class:"col s12 m4"},D=["disabled"],S=m((()=>(0,a._)("i",{class:"material-icons right"},"calculate",-1))),U={class:"col s12 m2 offset-m3"},C={class:"col s12 m3"},x={key:0},z={key:0,class:"red-text"},T={class:"progress"},H={class:"highlight centered responsive-table"},Y=m((()=>(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",null,"Дата"),(0,a._)("th",null,"Счёт"),(0,a._)("th",null,"Сумма"),(0,a._)("th",{class:"fixed-width"},"Комментарий"),(0,a._)("th",{class:"fixed-width"},"Действия")])],-1))),M={class:"row mb-0 flex-center"},N={class:"col"},Z=["id"],q=m((()=>(0,a._)("i",{class:"material-icons"},"done_all",-1))),I=[q],J={class:"col"},A=["id","data-target"],E=m((()=>(0,a._)("i",{class:"material-icons"},"edit",-1))),K=[E],B={class:"col"},L=["id"],P=m((()=>(0,a._)("i",{class:"material-icons"},"delete",-1))),V=[P];var W=(0,a.aZ)({__name:"PlanningView",setup(e){const{categoriesAvailableForLimitation:l}=(0,o.Jk)((0,d.x)()),{selectedTransactionId:t,outcomeTransactions:m,transactionsMonthFilter:q}=(0,o.Jk)((0,c.C)()),{changeTransactionToRegular:E}=(0,c.C)(),{limits:P}=(0,o.Jk)((0,u.L)()),{currencyFilter:W,dateFilter:j}=(0,v.y)(),O=(0,a.Fl)((()=>l.value.map((e=>{const l=m.value.filter((l=>l.categoryId===e.id)).filter((e=>e.isForecast))||[],t=m.value.filter((l=>l.categoryId===e.id)).filter((e=>!e.isForecast)).reduce(((e,l)=>Number((e+=+l.amount).toFixed(2))),0),a=P.value.find((l=>l.categoryId===e.id));let n;n=a?a.limit:0;const r=t-n>0?Number((t-n).toFixed(2)):0,i=n>0?100*t/n:n,s=i>100?100:i,o=i<80?"green":i<100?"yellow":"red";return{...e,records:l,spend:t,limit:n,overspend:r,progressPercent:s,progressColor:o}})).sort(((e,l)=>e.name>l.name?1:e.name<l.name?-1:0)))),R=(0,a.Fl)((()=>{if(12===q.value){let e=O.value.reduce(((e,l)=>Number((e+l.limit).toFixed(2))),0);return e*=q.value,e}return O.value.reduce(((e,l)=>Number((e+l.limit).toFixed(2))),0)})),$=(0,a.Fl)((()=>O.value.reduce(((e,l)=>Number((e+l.spend).toFixed(2))),0))),G=(0,a.Fl)((()=>O.value.reduce(((e,l)=>Number((e+l.overspend).toFixed(2))),0))),Q=e=>{let l;l="BUTTON"===e.target.tagName?e.target:e.target.parentElement,t.value=l.id};let X=0;const ee=async e=>{const l=e;try{if(X++,Q(l),!t.value)return;await E()}catch(a){console.log(a),X<5&&setTimeout((()=>ee(l)),100)}};return(e,t)=>{const o=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)(a.HY,null,[_,g,0===(0,n.SU)(l).length?((0,a.wg)(),(0,a.iD)("div",w,[(0,a._)("div",p,[k,(0,a._)("p",null,[(0,a.Uk)("Добавьте хотя бы одну расходную "),(0,a.Wm)(o,{to:"/categories"},{default:(0,a.w5)((()=>[(0,a.Uk)("категорию")])),_:1})])])])):((0,a.wg)(),(0,a.iD)("div",h,[(0,a._)("h5",null,[(0,a.Uk)(" Запланировано: "+(0,r.zw)((0,n.SU)(W)(R.value))+". Израсходовано: "+(0,r.zw)((0,n.SU)(W)($.value))+". ",1),G.value>0?((0,a.wg)(),(0,a.iD)("small",f," Перерасход: "+(0,r.zw)((0,n.SU)(W)(G.value)),1)):(0,a.kq)("",!0)])])),O.value.length>0?((0,a.wg)(),(0,a.iD)("section",y,[(0,a._)("div",b,[(0,a._)("div",F,[(0,a._)("button",{disabled:0===(0,n.SU)(l).length,class:"btn modal-trigger","data-target":"modalSetLimit"},[S,(0,a.Uk)(" Установить лимит ")],8,D)]),(0,a._)("div",U,[(0,a.Wm)(s.Z)]),(0,a._)("div",C,[(0,a.Wm)(i.Z,{"show-all":!0})])]),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(O.value,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.id,class:"row"},[e&&(e.limit>0||e.records.length>0||e.spend>0)?((0,a.wg)(),(0,a.iD)("div",x,[(0,a._)("p",null,[(0,a._)("strong",null,(0,r.zw)(e.name),1),(0,a.Uk)(" "+(0,r.zw)((0,n.SU)(W)(e["spend"]))+" из "+(0,r.zw)((0,n.SU)(W)(e["limit"]))+" ",1),e.overspend>0?((0,a.wg)(),(0,a.iD)("small",z,"Перерасход на "+(0,r.zw)((0,n.SU)(W)(e.overspend)),1)):(0,a.kq)("",!0)]),(0,a._)("div",T,[(0,a._)("div",{class:(0,r.C_)([[e.progressColor],"determinate"]),style:(0,r.j5)({width:e.progressPercent+"%"})},null,6)]),(0,a._)("table",H,[Y,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.records,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",null,(0,r.zw)((0,n.SU)(j)(e["date"])),1),(0,a._)("td",null,(0,r.zw)(e["account"]),1),(0,a._)("td",null,(0,r.zw)((0,n.SU)(W)(e["amount"])),1),(0,a._)("td",null,(0,r.zw)(e["description"]),1),(0,a._)("td",null,[(0,a._)("div",M,[(0,a._)("div",N,[(0,a._)("button",{id:e.id,class:"green btn",onClick:ee},I,8,Z)]),(0,a._)("div",J,[(0,a._)("button",{id:e.id,"data-target":"transfer"===e.type?"modalEditTransfer":"modalEditTransaction",class:"yellow btn modal-trigger black-text",onClick:Q},K,8,A)]),(0,a._)("div",B,[(0,a._)("button",{id:e.id,class:"red btn modal-trigger","data-target":"modalDeleteTransaction",onClick:Q},V,8,L)])])])])))),128))])])])):(0,a.kq)("",!0)])))),128))])):(0,a.kq)("",!0)],64)}}}),j=t(89);const O=(0,j.Z)(W,[["__scopeId","data-v-4d7a384f"]]);var R=O}}]);
//# sourceMappingURL=889.c1137940.js.map