"use strict";(self["webpackChunkmoney_catcher"]=self["webpackChunkmoney_catcher"]||[]).push([[169],{5509:function(e,l,t){t.d(l,{$:function(){return a}});const a=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"]},24:function(e,l,t){t.d(l,{A:function(){return L}});var a=t(6768),n=t(144),r=t(4232),s=t(5130),o=t(6995),i=t(3367),u=t(5509);const c={class:"input-field"},d={key:0,selected:"",value:"12"},v=["value"],k=(0,a.Lk)("label",null,"Фильтрация по месяцам",-1);var m=(0,a.pM)({__name:"MonthSelectComponent",props:{showAll:{type:Boolean}},setup(e){const{transactionsMonthFilter:l}=(0,i.bP)((0,o.G)()),t=(0,n.KR)(),m=(0,n.KR)();return(0,a.sV)((()=>{m.value=M.FormSelect.init(t.value)})),(e,o)=>((0,a.uX)(),(0,a.CE)("div",c,[(0,a.bo)((0,a.Lk)("select",{ref_key:"monthSelect",ref:t,"onUpdate:modelValue":o[0]||(o[0]=e=>(0,n.i9)(l)?l.value=e:null)},[e.$props.showAll?((0,a.uX)(),(0,a.CE)("option",d,"Показать всё")):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)((0,n.R1)(u.$),((e,l)=>((0,a.uX)(),(0,a.CE)("option",{key:l,value:l},(0,r.v_)(e),9,v)))),128))],512),[[s.u1,(0,n.R1)(l),void 0,{number:!0}]]),k]))}});const p=m;var L=p},2122:function(e,l,t){t.d(l,{A:function(){return p}});t(4114);var a=t(6768),n=t(144),r=t(4232),s=t(5130),o=t(6995),i=t(3367),u=t(2132);const c={class:"input-field"},d=["value"],v=(0,a.Lk)("label",null,"Фильтрация по годам",-1);var k=(0,a.pM)({__name:"YearSelectComponent",setup(e){const{transactions:l,transactionsYearFilter:t}=(0,i.bP)((0,o.G)()),{isGlobalLoading:k}=(0,i.bP)((0,u.X)());k.value=!0;const m=(0,n.KR)(),p=(0,n.KR)(),L=(0,a.EW)((()=>{const e=[],t=new Set;t.add((new Date).getFullYear()),l.value.forEach((e=>{const l=new Date(e.date).getFullYear();t.add(l)}));const a=Math.max.apply(null,Array.from(t))+1;t.add(a);const n=Array.from(t).sort(((e,l)=>e-l));return n.forEach((l=>{const t={year:l,id:Math.floor(1e6*Math.random())};e.push(t)})),k.value=!1,e}));return(0,a.sV)((()=>{p.value=M.FormSelect.init(m.value)})),(0,a.$u)((()=>{p.value=M.FormSelect.init(m.value)})),(e,l)=>((0,a.uX)(),(0,a.CE)("div",c,[(0,a.bo)((0,a.Lk)("select",{ref_key:"yearSelect",ref:m,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,n.i9)(t)?t.value=e:null)},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(L.value,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e.id,value:e.year},(0,r.v_)(e.year),9,d)))),128))],512),[[s.u1,(0,n.R1)(t),void 0,{number:!0}]]),v]))}});const m=k;var p=m},169:function(e,l,t){t.r(l),t.d(l,{default:function(){return z}});var a=t(6768),n=t(144),r=t(4232),s=t(24),o=t(2122),i=t(3367),u=t(8078),c=t(6995),d=t(5254),v=t(6459);const k=e=>((0,a.Qi)("data-v-6903b50e"),e=e(),(0,a.jt)(),e),m=k((()=>(0,a.Lk)("h3",null,"Планирование",-1))),p=k((()=>(0,a.Lk)("hr",null,null,-1))),L={key:0,class:"row"},g={class:"col"},b=k((()=>(0,a.Lk)("p",null,"У Вас нет ни одной расходной категории.",-1))),h={key:1,class:"row"},f={key:0,class:"red-text"},y={key:2},C={class:"row valign-wrapper"},E={class:"col s12 m4"},F=["disabled"],_=k((()=>(0,a.Lk)("i",{class:"material-icons right"},"calculate",-1))),w={class:"col s12 m2 offset-m3"},X={class:"col s12 m3"},R={class:"row scrollable"},x={key:0,class:"row"},M={key:0,class:"red-text"},A={class:"progress"},T={class:"highlight centered responsive-table"},W=k((()=>(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Дата"),(0,a.Lk)("th",null,"Счёт"),(0,a.Lk)("th",null,"Сумма"),(0,a.Lk)("th",{class:"fixed-width"},"Комментарий"),(0,a.Lk)("th",{class:"fixed-width"},"Действия")])],-1))),I={class:"row mb-0 flex-center"},K={class:"col"},P=["id"],S=k((()=>(0,a.Lk)("i",{class:"material-icons"},"done_all",-1))),N=[S],Q={class:"col"},G=["id","data-target"],V=k((()=>(0,a.Lk)("i",{class:"material-icons"},"edit",-1))),Y=[V],$={class:"col"},D=["id"],U=k((()=>(0,a.Lk)("i",{class:"material-icons"},"delete",-1))),B=[U];var j=(0,a.pM)({__name:"PlanningView",setup(e){const{categoriesAvailableForLimitation:l}=(0,i.bP)((0,u.d)()),{selectedTransactionId:t,outcomeTransactions:k,transactionsMonthFilter:S}=(0,i.bP)((0,c.G)()),{changeTransactionToRegular:V}=(0,c.G)(),{limitsYearMonth:U}=(0,i.bP)((0,d.A)()),{currencyFilter:j,dateFilter:O}=(0,v.c)(),q=(0,a.EW)((()=>l.value?.map((e=>{const l=k.value.filter((l=>l.categoryId===e.id)).filter((e=>e.isForecast))||[],t=k.value.filter((l=>l.categoryId===e.id)).filter((e=>!e.isForecast)).reduce(((e,l)=>Number((e+=+l.amount).toFixed(2))),0);let a,n;a=0!==U.value.length?U.value.find((l=>l.categoryId===e.id)):null,n=a?a.limit:0;const r=t-n>0?Number((t-n).toFixed(2)):0,s=n>0?100*t/n:n,o=s>100?100:s,i=s<80?"green":s<100?"yellow":"red";return{...e,records:l,spend:t,limit:n,overspend:r,progressPercent:o,progressColor:i}})).sort(((e,l)=>e.name>l.name?1:e.name<l.name?-1:0)))),z=(0,a.EW)((()=>{if(12===S.value){let e=q.value.reduce(((e,l)=>Number((e+l.limit).toFixed(2))),0);return e*=S.value,e}return q.value.reduce(((e,l)=>Number((e+l.limit).toFixed(2))),0)})),H=(0,a.EW)((()=>q.value.reduce(((e,l)=>Number((e+l.spend).toFixed(2))),0))),J=(0,a.EW)((()=>q.value.reduce(((e,l)=>Number((e+l.overspend).toFixed(2))),0))),Z=e=>{let l;l="BUTTON"===e.target.tagName?e.target:e.target.parentElement,t.value=l.id};let ee=0;const le=async e=>{const l=e;try{if(ee++,Z(l),!t.value)return;await V()}catch(a){console.log(a),ee<5&&setTimeout((()=>le(l)),100)}};return(e,t)=>{const i=(0,a.g2)("router-link");return(0,a.uX)(),(0,a.CE)(a.FK,null,[m,p,0===(0,n.R1)(l).length?((0,a.uX)(),(0,a.CE)("div",L,[(0,a.Lk)("div",g,[b,(0,a.Lk)("p",null,[(0,a.eW)("Добавьте хотя бы одну расходную "),(0,a.bF)(i,{to:"/categories"},{default:(0,a.k6)((()=>[(0,a.eW)("категорию")])),_:1})])])])):((0,a.uX)(),(0,a.CE)("div",h,[(0,a.Lk)("h5",null,[(0,a.eW)(" Запланировано: "+(0,r.v_)((0,n.R1)(j)(z.value))+". Израсходовано: "+(0,r.v_)((0,n.R1)(j)(H.value))+". ",1),J.value>0?((0,a.uX)(),(0,a.CE)("small",f," Перерасход: "+(0,r.v_)((0,n.R1)(j)(J.value)),1)):(0,a.Q3)("",!0)])])),q.value.length>0?((0,a.uX)(),(0,a.CE)("section",y,[(0,a.Lk)("div",C,[(0,a.Lk)("div",E,[(0,a.Lk)("button",{disabled:0===(0,n.R1)(l).length,class:"btn modal-trigger","data-target":"modalSetLimit"},[_,(0,a.eW)(" Установить лимит ")],8,F)]),(0,a.Lk)("div",w,[(0,a.bF)(o.A)]),(0,a.Lk)("div",X,[(0,a.bF)(s.A,{"show-all":!0})])]),(0,a.Lk)("div",R,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(q.value,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id},[e&&(e.limit>0||e.records.length>0||e.spend>0)?((0,a.uX)(),(0,a.CE)("div",x,[(0,a.Lk)("p",null,[(0,a.Lk)("strong",null,(0,r.v_)(e.name),1),(0,a.eW)(" "+(0,r.v_)((0,n.R1)(j)(e.spend))+" из "+(0,r.v_)((0,n.R1)(j)(e.limit))+" ",1),e.overspend>0?((0,a.uX)(),(0,a.CE)("small",M,"Перерасход на "+(0,r.v_)((0,n.R1)(j)(e.overspend)),1)):(0,a.Q3)("",!0)]),(0,a.Lk)("div",A,[(0,a.Lk)("div",{class:(0,r.C4)([[e.progressColor],"determinate"]),style:(0,r.Tr)({width:e.progressPercent+"%"})},null,6)]),(0,a.Lk)("table",T,[W,(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.records,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.id},[(0,a.Lk)("td",null,(0,r.v_)((0,n.R1)(O)(e["date"])),1),(0,a.Lk)("td",null,(0,r.v_)(e["account"]),1),(0,a.Lk)("td",null,(0,r.v_)((0,n.R1)(j)(e["amount"])),1),(0,a.Lk)("td",null,(0,r.v_)(e["description"]),1),(0,a.Lk)("td",null,[(0,a.Lk)("div",I,[(0,a.Lk)("div",K,[(0,a.Lk)("button",{id:e.id,class:"green btn",onClick:le},N,8,P)]),(0,a.Lk)("div",Q,[(0,a.Lk)("button",{id:e.id,"data-target":"transfer"===e.type?"modalEditTransfer":"modalEditTransaction",class:"yellow btn modal-trigger black-text",onClick:Z},Y,8,G)]),(0,a.Lk)("div",$,[(0,a.Lk)("button",{id:e.id,class:"red btn modal-trigger","data-target":"modalDeleteTransaction",onClick:Z},B,8,D)])])])])))),128))])])])):(0,a.Q3)("",!0)])))),128))])])):(0,a.Q3)("",!0)],64)}}}),O=t(1241);const q=(0,O.A)(j,[["__scopeId","data-v-6903b50e"]]);var z=q}}]);