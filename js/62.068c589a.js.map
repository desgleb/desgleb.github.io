{"version":3,"file":"js/62.068c589a.js","mappings":"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","sources":["webpack://money-catcher/./src/views/PlanningView.vue?8a4b","webpack://money-catcher/./src/views/PlanningView.vue","webpack://money-catcher/./src/views/PlanningView.vue?9fd6"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { createElementVNode as _createElementVNode, unref as _unref, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass, normalizeStyle as _normalizeStyle, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-5d9725b3\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"h3\", null, \"Планирование\", -1))\nconst _hoisted_2 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"hr\", null, null, -1))\nconst _hoisted_3 = { class: \"red-text\" }\nconst _hoisted_4 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"hr\", null, null, -1))\nconst _hoisted_5 = {\n  key: 0,\n  class: \"row\"\n}\nconst _hoisted_6 = { class: \"col\" }\nconst _hoisted_7 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"p\", null, \"У Вас нет ни одной расходной категории.\", -1))\nconst _hoisted_8 = {\n  key: 1,\n  class: \"row\"\n}\nconst _hoisted_9 = { class: \"col\" }\nconst _hoisted_10 = [\"disabled\"]\nconst _hoisted_11 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", { class: \"material-icons right\" }, \"calculate\", -1))\nconst _hoisted_12 = { key: 2 }\nconst _hoisted_13 = { key: 0 }\nconst _hoisted_14 = {\n  key: 0,\n  class: \"red-text\"\n}\nconst _hoisted_15 = { class: \"progress\" }\nconst _hoisted_16 = { class: \"highlight centered responsive-table\" }\nconst _hoisted_17 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"thead\", null, [\n  /*#__PURE__*/_createElementVNode(\"tr\", null, [\n    /*#__PURE__*/_createElementVNode(\"th\", null, \"Дата\"),\n    /*#__PURE__*/_createElementVNode(\"th\", null, \"Счёт\"),\n    /*#__PURE__*/_createElementVNode(\"th\", null, \"Сумма\"),\n    /*#__PURE__*/_createElementVNode(\"th\", null, \"Комментарий\"),\n    /*#__PURE__*/_createElementVNode(\"th\", null, \"Действия\")\n  ])\n], -1))\nconst _hoisted_18 = { class: \"row mb-0 flex-center\" }\nconst _hoisted_19 = { class: \"col\" }\nconst _hoisted_20 = [\"id\"]\nconst _hoisted_21 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", { class: \"material-icons\" }, \"done_all\", -1))\nconst _hoisted_22 = [\n  _hoisted_21\n]\nconst _hoisted_23 = { class: \"col\" }\nconst _hoisted_24 = [\"id\", \"data-target\"]\nconst _hoisted_25 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", { class: \"material-icons\" }, \"edit\", -1))\nconst _hoisted_26 = [\n  _hoisted_25\n]\nconst _hoisted_27 = { class: \"col\" }\nconst _hoisted_28 = [\"id\"]\nconst _hoisted_29 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"i\", { class: \"material-icons\" }, \"delete\", -1))\nconst _hoisted_30 = [\n  _hoisted_29\n]\n\nimport { storeToRefs } from 'pinia';\r\nimport { useCategoriesStore } from '@/stores/categories';\r\nimport { useTransactionsStore } from '@/stores/transactions';\r\nimport { usePlanningStore } from '@/stores/limits';\r\nimport { useFiltersStore } from '@/stores/filters';\r\nimport { computed } from 'vue';\r\n\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'PlanningView',\n  setup(__props) {\n\r\nconst { categoriesAvailableForLimitation } = storeToRefs(useCategoriesStore());\r\nconst {\r\n  selectedTransactionId,\r\n  outcomeTransactionsInThisMonth\r\n} = storeToRefs(useTransactionsStore());\r\nconst { changeTransactionToRegular } = useTransactionsStore();\r\nconst { limits } = storeToRefs(usePlanningStore());\r\nconst { currencyFilter, dateFilter } = useFiltersStore();\r\n\r\nconst limitCategories = computed(() => {\r\n  return categoriesAvailableForLimitation.value.map((cat) => {\r\n    const records = outcomeTransactionsInThisMonth.value\r\n      .filter((tr) => tr.categoryId === cat.id)\r\n      .filter((tr) => tr.isForecast) || [];\r\n\r\n    const spend: number = outcomeTransactionsInThisMonth.value\r\n      .filter((tr) => tr.categoryId === cat.id)\r\n      .filter((tr) => !tr.isForecast).reduce((total, record): number => {\r\n        // noinspection JSUnusedAssignment\r\n        return Number((total += +record.amount).toFixed(2));\r\n      }, 0);\r\n\r\n    const limitInfo = limits.value.find((lim) => lim.categoryId === cat.id);\r\n\r\n    let limit: number;\r\n    if (!!limitInfo) {\r\n      limit = limitInfo.limit;\r\n    } else {\r\n      limit = 0;\r\n    }\r\n\r\n    const overspend: number = Number((spend - limit).toFixed(2));\r\n\r\n    const percent: number = limit > 0 ? (100 * spend) / limit : limit;\r\n    const progressPercent: number = percent > 100 ? 100 : percent;\r\n\r\n    const progressColor: string = percent < 80 ? 'green' : percent < 100 ? 'yellow' : 'red';\r\n\r\n    return {\r\n      ...cat,\r\n      records,\r\n      spend,\r\n      limit,\r\n      overspend,\r\n      progressPercent,\r\n      progressColor\r\n    };\r\n  });\r\n});\r\n\r\nconst limitTotal = computed((): number => {\r\n  return limitCategories.value.reduce((total, cat) => {\r\n    return Number((total + cat.limit).toFixed(2));\r\n  }, 0);\r\n});\r\n\r\nconst spendTotal = computed((): number => {\r\n  return limitCategories.value.reduce((total, cat) => {\r\n    return Number((total + cat.spend).toFixed(2));\r\n  }, 0);\r\n});\r\n\r\nconst notPlannedTotal = computed((): number => {\r\n  return outcomeTransactionsInThisMonth.value\r\n    .filter((tr) => tr.isNotPlanned)\r\n    .reduce((total, tr) => {\r\n      return Number((total + tr.amount).toFixed(2));\r\n    }, 0);\r\n});\r\n\r\nconst setTransactionId = (event: any) => {\r\n  let el: HTMLButtonElement;\r\n  if (event.target.tagName === 'BUTTON') {\r\n    el = event.target;\r\n  } else {\r\n    el = event.target.parentElement;\r\n  }\r\n  selectedTransactionId.value = el.id;\r\n};\r\n\r\nconst setRegular = async (event: any) => {\r\n  setTransactionId(event);\r\n  if (!selectedTransactionId.value) return;\r\n  await changeTransactionToRegular();\r\n};\r\n\nreturn (_ctx: any,_cache: any) => {\n  const _component_router_link = _resolveComponent(\"router-link\")!\n\n  return (_openBlock(), _createElementBlock(_Fragment, null, [\n    _hoisted_1,\n    _hoisted_2,\n    _createElementVNode(\"h5\", null, [\n      _createTextVNode(\"Запланировано: \" + _toDisplayString(_unref(currencyFilter)(limitTotal.value)) + \". Израсходовано: \" + _toDisplayString(_unref(currencyFilter)(spendTotal.value)) + \". \", 1),\n      _createElementVNode(\"small\", _hoisted_3, \"Перерасход: \" + _toDisplayString(_unref(currencyFilter)((spendTotal.value + notPlannedTotal.value) - limitTotal.value)), 1)\n    ]),\n    _hoisted_4,\n    (_unref(categoriesAvailableForLimitation).length === 0)\n      ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [\n          _createElementVNode(\"div\", _hoisted_6, [\n            _hoisted_7,\n            _createElementVNode(\"p\", null, [\n              _createTextVNode(\"Добавьте хотя бы одну расходную \"),\n              _createVNode(_component_router_link, { to: \"/categories\" }, {\n                default: _withCtx(() => [\n                  _createTextVNode(\"категорию\")\n                ]),\n                _: 1\n              })\n            ])\n          ])\n        ]))\n      : (_openBlock(), _createElementBlock(\"div\", _hoisted_8, [\n          _createElementVNode(\"div\", _hoisted_9, [\n            _createElementVNode(\"button\", {\n              disabled: _unref(categoriesAvailableForLimitation).length === 0,\n              class: \"btn modal-trigger\",\n              \"data-target\": \"modalSetLimit\"\n            }, [\n              _hoisted_11,\n              _createTextVNode(\" Установить лимит \")\n            ], 8, _hoisted_10)\n          ])\n        ])),\n    (limitCategories.value.length > 0)\n      ? (_openBlock(), _createElementBlock(\"section\", _hoisted_12, [\n          (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(limitCategories.value, (cat) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n              key: cat.id!,\n              class: \"row\"\n            }, [\n              (!!cat)\n                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [\n                    _createElementVNode(\"p\", null, [\n                      _createElementVNode(\"strong\", null, _toDisplayString(cat.name), 1),\n                      _createTextVNode(\" \" + _toDisplayString(_unref(currencyFilter)(cat.spend)) + \" из \" + _toDisplayString(_unref(currencyFilter)(cat.limit)) + \" \", 1),\n                      (cat.overspend > 0)\n                        ? (_openBlock(), _createElementBlock(\"small\", _hoisted_14, \"Перерасход на \" + _toDisplayString(_unref(currencyFilter)(cat.overspend)), 1))\n                        : _createCommentVNode(\"\", true)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_15, [\n                      _createElementVNode(\"div\", {\n                        class: _normalizeClass([[cat.progressColor], \"determinate\"]),\n                        style: _normalizeStyle({ width: cat.progressPercent + '%' })\n                      }, null, 6)\n                    ]),\n                    _createElementVNode(\"table\", _hoisted_16, [\n                      _hoisted_17,\n                      _createElementVNode(\"tbody\", null, [\n                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(cat.records, (rec) => {\n                          return (_openBlock(), _createElementBlock(\"tr\", {\n                            key: rec.id\n                          }, [\n                            _createElementVNode(\"td\", null, _toDisplayString(_unref(dateFilter)(rec['date'])), 1),\n                            _createElementVNode(\"td\", null, _toDisplayString(rec['account']), 1),\n                            _createElementVNode(\"td\", null, _toDisplayString(_unref(currencyFilter)(rec['amount'])), 1),\n                            _createElementVNode(\"td\", null, _toDisplayString(rec['description']), 1),\n                            _createElementVNode(\"td\", null, [\n                              _createElementVNode(\"div\", _hoisted_18, [\n                                _createElementVNode(\"div\", _hoisted_19, [\n                                  _createElementVNode(\"button\", {\n                                    id: rec.id,\n                                    class: \"green btn\",\n                                    onClick: setRegular\n                                  }, _hoisted_22, 8, _hoisted_20)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_23, [\n                                  _createElementVNode(\"button\", {\n                                    id: rec.id,\n                                    \"data-target\": rec.type === 'transfer' ? 'modalEditTransfer' : 'modalEditTransaction',\n                                    class: \"yellow btn modal-trigger black-text\",\n                                    onClick: setTransactionId\n                                  }, _hoisted_26, 8, _hoisted_24)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_27, [\n                                  _createElementVNode(\"button\", {\n                                    id: rec.id,\n                                    class: \"red btn modal-trigger\",\n                                    \"data-target\": \"modalDeleteTransaction\",\n                                    onClick: setTransactionId\n                                  }, _hoisted_30, 8, _hoisted_28)\n                                ])\n                              ])\n                            ])\n                          ]))\n                        }), 128))\n                      ])\n                    ])\n                  ]))\n                : _createCommentVNode(\"\", true)\n            ]))\n          }), 128))\n        ]))\n      : _createCommentVNode(\"\", true)\n  ], 64))\n}\n}\n\n})","<template>\r\n  <h3>Планирование</h3>\r\n  <hr>\r\n  <h5>Запланировано: {{ currencyFilter(limitTotal) }}. Израсходовано: {{ currencyFilter(spendTotal) }}. <small\r\n    class=\"red-text\">Перерасход: {{ currencyFilter((spendTotal + notPlannedTotal) - limitTotal) }}</small></h5>\r\n  <hr>\r\n  <div v-if=\"categoriesAvailableForLimitation.length === 0\" class=\"row\">\r\n    <div class=\"col\">\r\n      <p>У Вас нет ни одной расходной категории.</p>\r\n      <p>Добавьте хотя бы одну расходную\r\n        <router-link to=\"/categories\">категорию</router-link>\r\n      </p>\r\n    </div>\r\n  </div>\r\n  <div v-else class=\"row\">\r\n    <div class=\"col\">\r\n      <button\r\n        :disabled=\"categoriesAvailableForLimitation.length === 0\"\r\n        class=\"btn modal-trigger\"\r\n        data-target=\"modalSetLimit\">\r\n        <i class=\"material-icons right\">calculate</i>\r\n        Установить лимит\r\n      </button>\r\n    </div>\r\n  </div>\r\n\r\n  <section v-if=\"limitCategories.length > 0\">\r\n    <div v-for=\"cat in limitCategories\" :key=\"cat.id!\" class=\"row\">\r\n      <div v-if=\"!!cat\">\r\n        <p>\r\n          <strong>{{ cat.name }}</strong>\r\n          {{ currencyFilter(cat.spend) }} из {{ currencyFilter(cat.limit) }}\r\n          <small v-if=\"cat.overspend > 0\" class=\"red-text\">Перерасход на {{ currencyFilter(cat.overspend) }}</small>\r\n        </p>\r\n        <div class=\"progress\">\r\n          <div\r\n            :class=\"[cat.progressColor]\"\r\n            :style=\"{ width: cat.progressPercent + '%' }\"\r\n            class=\"determinate\"></div>\r\n        </div>\r\n        <table class=\"highlight centered responsive-table\">\r\n          <thead>\r\n          <tr>\r\n            <th>Дата</th>\r\n            <th>Счёт</th>\r\n            <th>Сумма</th>\r\n            <th>Комментарий</th>\r\n            <th>Действия</th>\r\n          </tr>\r\n          </thead>\r\n\r\n          <tbody>\r\n          <tr v-for=\"rec in cat.records\" :key=\"rec.id\">\r\n            <td>{{ dateFilter(rec['date']) }}</td>\r\n            <td>{{ rec['account'] }}</td>\r\n            <td>{{ currencyFilter(rec['amount']) }}</td>\r\n            <td>{{ rec['description'] }}</td>\r\n            <td>\r\n              <div class=\"row mb-0 flex-center\">\r\n                <div class=\"col\">\r\n                  <button\r\n                    :id=\"rec.id\"\r\n                    class=\"green btn\"\r\n                    @click=\"setRegular\">\r\n                    <i class=\"material-icons\">done_all</i>\r\n                  </button>\r\n                </div>\r\n                <div class=\"col\">\r\n                  <button\r\n                    :id=\"rec.id\"\r\n                    :data-target=\"rec.type === 'transfer' ? 'modalEditTransfer' : 'modalEditTransaction'\"\r\n                    class=\"yellow btn modal-trigger black-text\"\r\n                    @click=\"setTransactionId\">\r\n                    <i class=\"material-icons\">edit</i>\r\n                  </button>\r\n                </div>\r\n                <div class=\"col\">\r\n                  <button\r\n                    :id=\"rec.id\"\r\n                    class=\"red btn modal-trigger\"\r\n                    data-target=\"modalDeleteTransaction\"\r\n                    @click=\"setTransactionId\">\r\n                    <i class=\"material-icons\">delete</i>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </td>\r\n          </tr>\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  </section>\r\n\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport { storeToRefs } from 'pinia';\r\nimport { useCategoriesStore } from '@/stores/categories';\r\nimport { useTransactionsStore } from '@/stores/transactions';\r\nimport { usePlanningStore } from '@/stores/limits';\r\nimport { useFiltersStore } from '@/stores/filters';\r\nimport { computed } from 'vue';\r\n\r\nconst { categoriesAvailableForLimitation } = storeToRefs(useCategoriesStore());\r\nconst {\r\n  selectedTransactionId,\r\n  outcomeTransactionsInThisMonth\r\n} = storeToRefs(useTransactionsStore());\r\nconst { changeTransactionToRegular } = useTransactionsStore();\r\nconst { limits } = storeToRefs(usePlanningStore());\r\nconst { currencyFilter, dateFilter } = useFiltersStore();\r\n\r\nconst limitCategories = computed(() => {\r\n  return categoriesAvailableForLimitation.value.map((cat) => {\r\n    const records = outcomeTransactionsInThisMonth.value\r\n      .filter((tr) => tr.categoryId === cat.id)\r\n      .filter((tr) => tr.isForecast) || [];\r\n\r\n    const spend: number = outcomeTransactionsInThisMonth.value\r\n      .filter((tr) => tr.categoryId === cat.id)\r\n      .filter((tr) => !tr.isForecast).reduce((total, record): number => {\r\n        // noinspection JSUnusedAssignment\r\n        return Number((total += +record.amount).toFixed(2));\r\n      }, 0);\r\n\r\n    const limitInfo = limits.value.find((lim) => lim.categoryId === cat.id);\r\n\r\n    let limit: number;\r\n    if (!!limitInfo) {\r\n      limit = limitInfo.limit;\r\n    } else {\r\n      limit = 0;\r\n    }\r\n\r\n    const overspend: number = Number((spend - limit).toFixed(2));\r\n\r\n    const percent: number = limit > 0 ? (100 * spend) / limit : limit;\r\n    const progressPercent: number = percent > 100 ? 100 : percent;\r\n\r\n    const progressColor: string = percent < 80 ? 'green' : percent < 100 ? 'yellow' : 'red';\r\n\r\n    return {\r\n      ...cat,\r\n      records,\r\n      spend,\r\n      limit,\r\n      overspend,\r\n      progressPercent,\r\n      progressColor\r\n    };\r\n  });\r\n});\r\n\r\nconst limitTotal = computed((): number => {\r\n  return limitCategories.value.reduce((total, cat) => {\r\n    return Number((total + cat.limit).toFixed(2));\r\n  }, 0);\r\n});\r\n\r\nconst spendTotal = computed((): number => {\r\n  return limitCategories.value.reduce((total, cat) => {\r\n    return Number((total + cat.spend).toFixed(2));\r\n  }, 0);\r\n});\r\n\r\nconst notPlannedTotal = computed((): number => {\r\n  return outcomeTransactionsInThisMonth.value\r\n    .filter((tr) => tr.isNotPlanned)\r\n    .reduce((total, tr) => {\r\n      return Number((total + tr.amount).toFixed(2));\r\n    }, 0);\r\n});\r\n\r\nconst setTransactionId = (event: any) => {\r\n  let el: HTMLButtonElement;\r\n  if (event.target.tagName === 'BUTTON') {\r\n    el = event.target;\r\n  } else {\r\n    el = event.target.parentElement;\r\n  }\r\n  selectedTransactionId.value = el.id;\r\n};\r\n\r\nconst setRegular = async (event: any) => {\r\n  setTransactionId(event);\r\n  if (!selectedTransactionId.value) return;\r\n  await changeTransactionToRegular();\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.row.mb-0 {\r\n  margin-bottom: 0;\r\n}\r\n\r\n.flex-center {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n\r\n  & .ml-0 {\r\n    margin-left: unset;\r\n  }\r\n}\r\n</style>","import script from \"./PlanningView.vue?vue&type=script&lang=ts&setup=true\"\nexport * from \"./PlanningView.vue?vue&type=script&lang=ts&setup=true\"\n\nimport \"./PlanningView.vue?vue&type=style&index=0&id=5d9725b3&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-5d9725b3\"]])\n\nexport default __exports__"],"names":["_withScopeId","n","_pushScopeId","_popScopeId","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","class","_hoisted_4","_hoisted_5","key","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_defineComponent","__name","setup","__props","categoriesAvailableForLimitation","storeToRefs","useCategoriesStore","selectedTransactionId","outcomeTransactionsInThisMonth","useTransactionsStore","changeTransactionToRegular","limits","usePlanningStore","currencyFilter","dateFilter","useFiltersStore","limitCategories","computed","value","map","cat","records","filter","tr","categoryId","id","isForecast","spend","reduce","total","record","Number","amount","toFixed","limitInfo","find","lim","limit","overspend","percent","progressPercent","progressColor","limitTotal","spendTotal","notPlannedTotal","isNotPlanned","setTransactionId","event","el","target","tagName","parentElement","setRegular","async","_ctx","_cache","_component_router_link","_resolveComponent","_openBlock","_createElementBlock","_Fragment","_createTextVNode","_toDisplayString","_unref","length","_createVNode","to","default","_withCtx","_","disabled","_renderList","name","_createCommentVNode","_normalizeClass","style","_normalizeStyle","width","rec","onClick","type","__exports__"],"sourceRoot":""}