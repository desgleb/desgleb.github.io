"use strict";(self["webpackChunkvue_cash"]=self["webpackChunkvue_cash"]||[]).push([[480],{6480:function(e,t,i){i.r(t),i.d(t,{default:function(){return q}});var n=i(3396),a=i(9242),s=i(7139);const l=(0,n._)("div",{class:"page-title"},[(0,n._)("h3",null,"Новая запись")],-1),o={key:1,class:"center"},u={class:"input-field"},r=["value"],d=(0,n._)("label",null,"Выберите категорию",-1),c=(0,n._)("span",null,"Доход",-1),p=(0,n._)("span",null,"Расход",-1),h={class:"input-field"},m=(0,n._)("label",{for:"amount"},"Сумма",-1),y={key:0,class:"helper-text invalid"},v={class:"input-field"},g=(0,n._)("label",{for:"description"},"Описание",-1),f={key:0,class:"helper-text invalid"},$=(0,n._)("button",{class:"btn waves-effect waves-light",type:"submit"},[(0,n.Uk)(" Создать "),(0,n._)("i",{class:"material-icons right"},"send")],-1);function w(e,t,i,w,_,b){const k=(0,n.up)("Loader"),V=(0,n.up)("router-link");return(0,n.wg)(),(0,n.iD)("div",null,[l,_.loading?((0,n.wg)(),(0,n.j4)(k,{key:0})):_.categories.length?((0,n.wg)(),(0,n.iD)("form",{key:2,class:"form",onSubmit:t[5]||(t[5]=(0,a.iM)(((...e)=>b.handleSubmit&&b.handleSubmit(...e)),["prevent"]))},[(0,n._)("div",u,[(0,n.wy)((0,n._)("select",{ref:"select","onUpdate:modelValue":t[0]||(t[0]=e=>_.category=e)},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(_.categories,(e=>((0,n.wg)(),(0,n.iD)("option",{key:e.id,value:e.id},(0,s.zw)(e.title),9,r)))),128))],512),[[a.bM,_.category]]),d]),(0,n._)("p",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{class:"with-gap",name:"type",type:"radio",value:"income","onUpdate:modelValue":t[1]||(t[1]=e=>_.type=e)},null,512),[[a.G2,_.type]]),c])]),(0,n._)("p",null,[(0,n._)("label",null,[(0,n.wy)((0,n._)("input",{class:"with-gap",name:"type",type:"radio",value:"outcome","onUpdate:modelValue":t[2]||(t[2]=e=>_.type=e)},null,512),[[a.G2,_.type]]),p])]),(0,n._)("div",h,[(0,n.wy)((0,n._)("input",{id:"amount",type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>_.amount=e),class:(0,s.C_)({invalid:w.v$.amount.$dirty&&b.amountMinInvalid})},null,2),[[a.nr,_.amount,void 0,{number:!0}]]),m,w.v$.amount.$dirty&&b.amountMinInvalid?((0,n.wg)(),(0,n.iD)("span",y," Минимальная величина "+(0,s.zw)(b.amountMinValue),1)):(0,n.kq)("",!0)]),(0,n._)("div",v,[(0,n.wy)((0,n._)("input",{id:"description",type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>_.description=e),class:(0,s.C_)({invalid:w.v$.description.$dirty&&b.descriptionRequired})},null,2),[[a.nr,_.description]]),g,w.v$.description.$dirty&&b.descriptionRequired?((0,n.wg)(),(0,n.iD)("span",f," Укажите описание ")):(0,n.kq)("",!0)]),$],32)):((0,n.wg)(),(0,n.iD)("p",o,[(0,n.Wm)(V,{to:"/categories"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Добавьте хотя бы одну категорию ")])),_:1})]))])}var _=i(8412),b=i(4219),k=i(5420),V=i(65),C={setup(){return{v$:(0,b.Xw)()}},name:"Record",components:{Loader:_.Z},data(){return{loading:!0,categories:[],select:null,category:null,type:"outcome",amount:1,description:""}},validations(){return{amount:{minValue:(0,k.uv)(.01)},description:{required:k.C1}}},computed:{...(0,V.Se)(["info"]),amountMinInvalid(){return this.v$.amount.minValue.$invalid},amountMinValue(){return this.v$.amount.minValue.$params.min},descriptionRequired(){return this.v$.description.required.$invalid},canCreateRecord(){return"income"===this.type||this.info.bill>=this.amount}},methods:{async handleSubmit(){if(this.v$.$invalid)this.v$.$touch();else if(this.canCreateRecord)try{await this.$store.dispatch("createRecord",{categoryId:this.category,amount:this.amount,description:this.description,type:this.type,date:(new Date).toJSON()});const e="income"===this.type?this.info.bill+this.amount:this.info.bill-this.amount;await this.$store.dispatch("updateInfo",{bill:e}),this.$message("Запись успешно создана"),this.v$.$reset(),this.amount=1,this.description=""}catch(e){}else this.$message(`Недостаточно средств на счете (${this.amount-this.info.bill})`)}},async mounted(){this.categories=await this.$store.dispatch("fetchCategories"),this.loading=!1,this.categories&&(this.category=this.categories[0].id),setTimeout((()=>{this.select=M.FormSelect.init(this.$refs.select),M.updateTextFields()}),0)},beforeUnmount(){this.select&&this.select.destroy&&this.select.destroy()}},D=i(89);const U=(0,D.Z)(C,[["render",w]]);var q=U}}]);
//# sourceMappingURL=480.b0150239.js.map